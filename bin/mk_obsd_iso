#!/bin/sh
#
#  <mk_obsd_iso>
#    Copyright 2002-2007 James Cook - All Rights Reserved.
#

downloadDir=/home/Shared/OpenBSD
if [ -d /Users/Shared/OpenBSD ]; then
	downloadDir=/Users/Shared/OpenBSD
fi

arch={$arch:-i386}
version=${version:-`ls $downloadDir | grep -e '^[0-9]\.[0-9]$' | tail -n1`}

svers=`/bin/echo -n ${version} | sed 's/\.//'`

echo "Using version ${version} (arch = ${arch}, svers=${svers})"

if [ -d "$version/$arch" ]; then
	echo Hmm... Ok...
	cd="."
elif [ -d "$downloadDir/$version/$arch" ]; then
	echo Good Enough...
	cd="$downloadDir"
else
	echo Go somewhere else.  Read the script if you have to.
	exit
fi

echo Making obsd${version}.iso in 3 seconds...
sleep 3

stage1boot="$version/$arch/cdbr"
stage2boot="$version/$arch/cdboot"

mkisofs -vrTJV "OpenBSD ${version} (${arch})"					\
	-no-emul-boot -b "${stage1boot}" -c boot.catalog			\
	-o "obsd${version}.${arch}.iso"						\
	-m "install${svers}.iso"						\
	-graft-points	"/${version}/"="${cd}/${version}/"			\
			"/cdboot"="${cd}/${stage2boot}"				\

