#!/usr/bin/perl
#
#  <fork>
#    Copyright 2008 Cook, J. MR  SSD, Inc. - All Rights Reserved.
#
#

use strict;

use Getopt::Std;

my %opts;
getopts ("qwW:xd:", \%opts);

if ($opts{"q"}) {
    open STDIN, "<", "/dev/null";
    open STDOUT, ">", "/dev/null";
    open STDERR, ">", "/dev/null";
}

if ($opts{"x"}) {
    my ($host, @rest) = split / /, $ENV{"SSH_CONNECTION"};
    
    if (defined($host) && $host ne "") {
        $ENV{"DISPLAY"} = $host . ":" . ($opts{"d"} || "0");
    }
}

if (my $child = fork()) {
    # we are parent
    if ($opts{"W"}) {
        sleep ($opts{"W"});
    } elsif ($opts{"w"}) {
        sleep 3;
    }
    
    exit 0;
}

exec @ARGV;